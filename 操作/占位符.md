# Rust 中 `_` 的用法总结

Rust 的 `_` 是一个多功能符号，在不同场景有不同用途，主要有以下几类：


## 占位符（忽略值）

* **作用**：告诉编译器 “这个值我不需要，用 `_` 占位”，避免未使用变量警告。
* **场景**：匹配模式、函数参数、解构、for 循环等。

**示例：**

```rust
let _ = 42; // 不使用这个值，不会报警告

let (x, _) = (1, 2); // 只关心 x，忽略 2

for _ in 0..5 {
    println!("Hello"); // 不需要循环变量
}
```

* 匹配中忽略某些分支：

```rust
let value = Some(10);
match value {
    Some(x) => println!("Got {}", x),
    _ => println!("Got nothing"), // 忽略其他情况
}
```

## 泛型占位符（类型推导）

* **作用**：告诉编译器 “这个类型由编译器推导”，常用在泛型函数或 Result/Option 构造中。
* **语法**：`::<_, Type>` 或 `::<Type, _>`

**示例：**

```rust
let x: Result<_, String> = Ok(42); // 编译器推导 Ok 的类型为 i32

fn foo<T>(val: T) -> Option<T> {
    Some(val)
}
let y = foo::<_>(5); // 编译器推导 T 为 i32
```


## 模式匹配占位符

* **作用**：在 `match` 或解构中忽略不关心的值。
* 区别：

  * `_` 忽略值，但不绑定
  * `_name` 忽略值，同时绑定（可避免未使用警告）

**示例：**

```rust
let point = (3, 4, 5);

match point {
    (x, _, z) => println!("x = {}, z = {}", x, z) // 忽略 y
}

let (_x, _y, z) = point; // _x 和 _y 被绑定但表示忽略
println!("z = {}", z);
```

## 作为函数参数占位符

* **作用**：函数参数不需要使用，但必须有参数时，用 `_` 占位。
* **语法**：

```rust
fn foo(_ignored: i32, used: i32) {
    println!("Used: {}", used);
}
foo(1, 2); // 输出: Used: 2
```

* 可以用 `_` 直接省略名称：

```rust
fn bar(_: i32) {
    println!("I don't care about the argument");
}
bar(5);
```


## 模块导入时的 `_`

* **作用**：部分导入或忽略导入，减少未使用警告

```rust
use std::collections::{HashMap, HashSet as _}; // HashSet 导入但不使用，不会警告
```


## 在闭包中占位类型

* **作用**：在闭包参数或类型中使用 `_`，让编译器推导类型

```rust
let v = vec![1, 2, 3];
let doubled: Vec<_> = v.iter().map(|x| x * 2).collect(); // Vec<i32> 自动推导
```


## 循环中 `_` 占位

* **作用**：循环变量不需要时用 `_` 占位

```rust
for _ in 0..10 {
    println!("Hello"); // 不需要循环变量
}
```


## 数组/元组模式匹配中的 `_`

* **作用**：忽略特定元素，不影响解构其他元素

```rust
let arr = [1, 2, 3, 4];
let [first, _, third, _] = arr;
println!("first = {}, third = {}", first, third);
```


## `_` 在泛型约束中

* **作用**：在 trait 或泛型约束中让编译器推导类型

```rust
fn generic_fn<T: std::fmt::Debug>(_val: T) {
    println!("Debug value");
}

generic_fn(42); // T 自动推导为 i32
```


## 总结

| 用法类别      | 说明                            |
| --------- | ----------------------------- |
| 忽略值       | `_` 占位不使用，避免警告                |
| 泛型类型推导    | `::<_, Type>` 或 `::<Type, _>` |
| 模式匹配忽略    | 忽略某些分支或值，不绑定                  |
| 函数参数占位    | 忽略未使用参数，避免警告                  |
| 模块导入占位    | 导入但不使用，避免警告                   |
| 闭包类型占位    | 让编译器推导类型                      |
| 循环变量占位    | 不关心循环计数器时使用                   |
| 数组/元组解构占位 | 忽略不关心的元素                      |
| 泛型约束类型推导  | trait 或泛型参数类型自动推导             |


## 技巧

* `_` 可以和名字组合：`_x`

  * 意义：绑定变量但表示忽略，避免未使用警告
* `_` 可以用在复杂类型中，让编译器自动推导，尤其是 `Result`, `Option`, `Vec<_>` 等。
