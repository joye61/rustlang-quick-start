# æ–¹æ³•

## ğŸ“Œ ä»€ä¹ˆæ˜¯â€œæ–¹æ³•â€ï¼Ÿ

åœ¨ Rust ä¸­ï¼Œâ€œ**æ–¹æ³•ï¼ˆmethodï¼‰**â€æ˜¯ä¸æŸä¸ª**ç»“æ„ä½“ã€æšä¸¾æˆ– trait å®ä¾‹ç»‘å®š**çš„å‡½æ•°ã€‚å®ƒä»¬é€šå¸¸é€šè¿‡ `impl` å—æ¥å®šä¹‰ï¼Œç”¨äºæ“ä½œè¯¥ç±»å‹çš„å€¼ã€‚

ä½ å¯ä»¥ç†è§£ä¸º C++ æˆ– Java ä¸­çš„â€œç±»æˆå‘˜å‡½æ•°â€ã€‚

---

## ä¸€ã€æ–¹æ³•å®šä¹‰çš„åŸºæœ¬ç»“æ„

```rust
struct User {
    name: String,
}

impl User {
    fn say_hi(&self) {
        println!("ä½ å¥½ï¼Œæˆ‘æ˜¯ {}", self.name);
    }
}
```

### âœ… æ–¹æ³•å®šä¹‰è¯­æ³•è¯´æ˜ï¼š

```rust
fn method_name(&self) {
    // æ–¹æ³•ä½“
}
```

- å¿…é¡»å†™åœ¨ `impl TypeName` å—ä¸­ã€‚
- ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ `self` | `&self` | `&mut self` ï¼ˆå€¼/å¼•ç”¨/å¯å˜å¼•ç”¨ä¹‹ä¸€ï¼‰ã€‚
- æ–¹æ³•åéµå¾ªè›‡å½¢å‘½åï¼š`do_something`ã€‚

---

## äºŒã€ä¸‰ç§ `self` ç”¨æ³•ï¼šæ–¹æ³•çš„æ¥æ”¶è€…

Rust æ²¡æœ‰ `this`ï¼Œè€Œæ˜¯ä½¿ç”¨ `self`ï¼Œå¯åˆ†ä¸ºä¸‰ç§æ–¹å¼ï¼š

| æ¥æ”¶æ–¹å¼    | å«ä¹‰è¯´æ˜               | ç¤ºä¾‹                          |
| ----------- | ---------------------- | ----------------------------- |
| `&self`     | åªè¯»å€Ÿç”¨               | `fn get_name(&self)`          |
| `&mut self` | å¯å˜å€Ÿç”¨               | `fn set_name(&mut self, ...)` |
| `self`      | å–å¾—æ‰€æœ‰æƒï¼ˆå€¼çš„ç§»åŠ¨ï¼‰ | `fn consume(self)`            |

### ç¤ºä¾‹ï¼šä¸‰ç§æ¥æ”¶æ–¹å¼

```rust
struct Counter { count: i32 }

impl Counter {
    fn get(&self) -> i32 {
        self.count
    }

    fn inc(&mut self) {
        self.count += 1;
    }

    fn into_inner(self) -> i32 {
        self.count
    }
}
```

---

## ä¸‰ã€å¸¦å‚æ•°çš„æ–¹æ³•

```rust
struct Rectangle {
    width: u32,
    height: u32,
}

impl Rectangle {
    fn area(&self) -> u32 {
        self.width * self.height
    }

    fn can_hold(&self, other: &Rectangle) -> bool {
        self.width >= other.width && self.height >= other.height
    }
}
```

---

## å››ã€å…³è”å‡½æ•°ï¼ˆä¸å¸¦ selfï¼‰

```rust
impl Rectangle {
    fn new(width: u32, height: u32) -> Self {
        Self { width, height }
    }
}
```

- æ²¡æœ‰ `self` å‚æ•°çš„å‡½æ•°å«**å…³è”å‡½æ•°**ï¼Œå¸¸ç”¨ä½œæ„é€ å™¨ã€‚
- é€šè¿‡ `TypeName::function()` è°ƒç”¨ã€‚

```rust
let r = Rectangle::new(30, 50);
```

---

## äº”ã€é“¾å¼è°ƒç”¨

æ–¹æ³•è¿”å› `Self` æˆ–å…¶ä»–ç±»å‹æ—¶å¯ä»¥é“¾å¼è°ƒç”¨ã€‚

```rust
struct Number(i32);

impl Number {
    fn add(self, x: i32) -> Self {
        Self(self.0 + x)
    }
    fn double(self) -> Self {
        Self(self.0 * 2)
    }
}

let result = Number(5).add(3).double(); // ç»“æœæ˜¯ (5+3)*2 = 16
```

---

## å…­ã€é™æ€æ–¹æ³• vs å®ä¾‹æ–¹æ³•

| ç±»å‹     | æ˜¯å¦æœ‰ `self` | è°ƒç”¨æ–¹å¼       | ä½œç”¨               |
| -------- | ------------- | -------------- | ------------------ | ------------- | ------------ |
| å®ä¾‹æ–¹æ³• | æœ‰            | `å¯¹è±¡.æ–¹æ³•()`  | æ“ä½œå¯¹è±¡è‡ªèº«       | `å®ä¾‹.æ–¹æ³•()` | æ“ä½œå¯¹è±¡è‡ªèº« |
| å…³è”å‡½æ•° | æ—             | `ç±»å‹::å‡½æ•°()` | å·¥å‚å‡½æ•°ã€å·¥å…·å‡½æ•° |

---

## ä¸ƒã€åŒä¸€ç±»å‹å¤šä¸ª `impl` å—

```rust
struct Cat;

impl Cat {
    fn meow() {
        println!("å–µ");
    }
}

impl Cat {
    fn jump() {
        println!("è·³ï¼");
    }
}
```

å¤šä¸ª `impl` å—å¯ä»¥æ‹†å¼€å†™ï¼Œä¸éœ€è¦ä¸€æ¬¡å®šä¹‰å®Œæ‰€æœ‰æ–¹æ³•ã€‚

---

## å…«ã€ä¸ºæ³›å‹ç±»å‹å®ç°æ–¹æ³•

```rust
struct Pair<T> {
    x: T,
    y: T,
}

impl<T> Pair<T> {
    fn new(x: T, y: T) -> Self {
        Self { x, y }
    }
}
```

å¦‚æœæ–¹æ³•åªå¯¹ç‰¹å®šç±»å‹æœ‰æ„ä¹‰ï¼Œå¯ä»¥åŠ çº¦æŸï¼š

```rust
impl<T: std::fmt::Display> Pair<T> {
    fn display(&self) {
        println!("({}, {})", self.x, self.y);
    }
}
```

---

## ä¹ã€ä¸ºæšä¸¾å®šä¹‰æ–¹æ³•

```rust
enum Shape {
    Circle(f64),
    Rectangle(f64, f64),
}

impl Shape {
    fn area(&self) -> f64 {
        match self {
            Shape::Circle(r) => 3.14 * r * r,
            Shape::Rectangle(w, h) => w * h,
        }
    }
}
```

---

## åã€æ–¹æ³•å¯ä»¥è¿”å›å¼•ç”¨ / å¯å˜å¼•ç”¨

```rust
struct User {
    name: String,
}

impl User {
    fn name(&self) -> &str {
        &self.name
    }

    fn name_mut(&mut self) -> &mut String {
        &mut self.name
    }
}
```

---

## åä¸€ã€æ–¹æ³•ä¸­ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸï¼ˆé«˜çº§ï¼‰

```rust
struct Text<'a> {
    content: &'a str,
}

impl<'a> Text<'a> {
    fn get(&self) -> &str {
        self.content
    }
}
```

å½“æ–¹æ³•è¿”å›å¼•ç”¨æ—¶ï¼ŒRust éœ€è¦çŸ¥é“å®ƒçš„ç”Ÿå‘½å‘¨æœŸã€‚

---

## åäºŒã€trait ä¸­çš„æ–¹æ³•ï¼ˆç®€è¿°ï¼‰

```rust
trait Speak {
    fn speak(&self);
}

struct Dog;

impl Speak for Dog {
    fn speak(&self) {
        println!("æ±ªï¼");
    }
}
```

æ–¹æ³•ä¹Ÿå¯ä»¥æ¥è‡ª traitï¼Œåç»­æˆ‘ä»¬å¯ä»¥ä¸“é—¨è®²è§£ trait ä¸å¤šæ€ã€‚

---

## ğŸ”š æ€»ç»“è„‘å›¾å¼è¦ç‚¹

| é¡¹ç›®          | è¯´æ˜                                 |
| ------------- | ------------------------------------ |
| `impl Type`   | å®šä¹‰æ–¹æ³•çš„è¯­æ³•å—                     |
| `&self`       | åªè¯»å€Ÿç”¨è°ƒç”¨è€…                       |
| `&mut self`   | å¯å˜å€Ÿç”¨è°ƒç”¨è€…                       |
| `self`        | å–å¾—è°ƒç”¨è€…çš„æ‰€æœ‰æƒ                   |
| `fn xxx(...)` | æ–¹æ³•å®šä¹‰è¯­æ³•ï¼Œå‚æ•°è‡ªå®šä¹‰             |
| è¿”å› `Self`   | å®ç°é“¾å¼è°ƒç”¨                         |
| æ—  `self`     | å…³è”å‡½æ•°ï¼ˆé™æ€æ–¹æ³•ï¼‰ï¼Œé€šå¸¸ä½œä¸ºæ„é€ å™¨ |
| å¤š impl       | å¯å¤šæ¬¡ `impl`ï¼Œæ”¯æŒæ‰©å±•ä¸æ‹†åˆ†é€»è¾‘    |
| æ³›å‹æ–¹æ³•      | ç”¨äºæ”¯æŒå¤šç§ç±»å‹                     |
| è¿”å›å¼•ç”¨      | å¯ç”¨äºè¿”å›å†…éƒ¨å­—æ®µï¼ˆåŠ ç”Ÿå‘½å‘¨æœŸï¼‰     |

---

# ğŸ” `Self` å’Œ `self` çš„åŒºåˆ«

---

## ä¸€ã€`Self` vs `self` çš„æœ¬è´¨åŒºåˆ«

| é¡¹ç›®   | å«ä¹‰                                                         | ä¸¾ä¾‹                  |
| ------ | ------------------------------------------------------------ | --------------------- |
| `self` | æ–¹æ³•ä¸­çš„**å‚æ•°å**ï¼Œè¡¨ç¤ºâ€œå½“å‰å®ä¾‹â€ ï¼ˆç±»ä¼¼ Java ä¸­çš„ `this`ï¼‰ | `fn method(&self)`    |
| `Self` | å½“å‰ç±»å‹çš„**ç±»å‹å**ï¼ˆç±»ä¼¼ Java ä¸­çš„ `this.class`ï¼‰          | `fn new(...) -> Self` |

### ğŸŒ± é€šä¿—ç†è§£ï¼š

- `self` æ˜¯â€œæˆ‘æœ¬äººâ€ï¼šå½“å‰å®ä¾‹ã€‚
- `Self` æ˜¯â€œæˆ‘çš„ç±»å‹â€ï¼šå½“å‰è¿™ä¸ªç»“æ„ä½“æˆ–æšä¸¾çš„åå­—ã€‚

---

## äºŒã€`self` çš„ç”¨æ³•ï¼šæ–¹æ³•æ¥æ”¶è€…

æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯ï¼š

| å†™æ³•        | æ„ä¹‰       | ä¾‹å­                  |
| ----------- | ---------- | --------------------- |
| `self`      | è·å–æ‰€æœ‰æƒ | `fn take(self)`       |
| `&self`     | åªè¯»å€Ÿç”¨   | `fn read(&self)`      |
| `&mut self` | å¯å˜å€Ÿç”¨   | `fn write(&mut self)` |

---

## ä¸‰ã€`Self` çš„ç”¨æ³•ï¼šç±»å‹çš„åˆ«å

```rust
impl MyType {
    fn new() -> Self { ... }           // æ„é€ å™¨ï¼Œè¿”å›å€¼ç±»å‹
    fn take(self) -> Self { ... }      // æ¶ˆè´¹è‡ªèº«ï¼Œè¿”å›æ–°å®ä¾‹
    fn borrow(&self) -> &Self { ... }  // å€Ÿç”¨è‡ªèº«ï¼Œè¿”å›å¼•ç”¨
}
```

1. **è¿”å›ç±»å‹æ˜¯å½“å‰ç±»å‹**

```rust
struct Point { x: i32, y: i32 }

// å†™æ³•1ï¼šä½¿ç”¨ Self
impl Point {
    fn new(x: i32, y: i32) -> Self {
        Self { x, y }
    }
}

// å†™æ³•2ï¼šä½¿ç”¨ç±»å‹å
impl Point {
    fn new(x: i32, y: i32) -> Point {
        Self { x, y }
    }
}
```

ä¸Šé¢ä¸¤ç§å†™æ³•ç­‰ä»·ï¼Œ`Self` ç›¸å½“äº `Point`

2. **æ„é€ æ–°å®ä¾‹ï¼ˆæ„é€ å™¨ï¼‰æ—¶å¸¸ç”¨**

```rust
fn reset(&self) -> Self {
    Self { x: 0, y: 0 }
}
```

---

## å››ã€æ–¹æ³•ä¸èƒ½è¿”å› `self`

**æ³¨æ„ï¼š`-> self` æ˜¯éæ³•è¯­æ³•ï¼Rust ä¸æ”¯æŒä»¥è¿™ç§æ–¹å¼è¿”å›å€¼ã€‚**

åªæ”¯æŒ `-> Self`ï¼Œä¸æ”¯æŒ `-> self`ã€‚å› ä¸º `self` ä¸æ˜¯ä¸€ä¸ªç±»å‹åï¼Œå®ƒæ˜¯ä¸€ä¸ªå‚æ•°åï¼Œè¡¨ç¤ºæ–¹æ³•æ¥æ”¶çš„å®ä¾‹ã€‚

## ä¸ºä»€ä¹ˆæ¨èç”¨ `Self` è€Œä¸æ˜¯ç±»å‹åï¼Ÿ

ä»¥ä¸‹è¿™äº›æƒ…å†µä¸­ **ç”¨ `Self` æ›´é€šç”¨ã€æ›´çµæ´»**ï¼š

1. æ³›å‹ç±»å‹ä¸­ï¼Œä¸ç¡®å®šå…·ä½“ç±»å‹åï¼š

```rust
impl<T> Container<T> {
    fn new(item: T) -> Self {
        Self { item }
    }
}
```

2. åœ¨ `trait` ä¸­å®šä¹‰æ–¹æ³•ï¼š

```rust
trait Summable {
    fn zero() -> Self;
}
```

trait å¯èƒ½ä¼šè¢«å¤šç§ç±»å‹å®ç°ã€‚æ¯”å¦‚ä½ æ˜¯ä¸º `Point` å®ç° `Summable`ï¼Œå†™æˆ `Self` ä¼šè‡ªåŠ¨æ¨å¯¼ä¸º `Point`ã€‚

---

## âœ… æ€»ç»“å°æŠ„

| ç”¨æ³•        | å«ä¹‰                   | æ˜¯å¦å¯ä½œè¿”å›ç±»å‹ |
| ----------- | ---------------------- | ---------------- |
| `self`      | å½“å‰å®ä¾‹ï¼ˆå‚æ•°ï¼‰       | âŒ               |
| `&self`     | å½“å‰å®ä¾‹çš„å¼•ç”¨ï¼ˆå‚æ•°ï¼‰ | âŒ               |
| `&mut self` | å¯å˜å¼•ç”¨ï¼ˆå‚æ•°ï¼‰       | âŒ               |
| `Self`      | å½“å‰ç±»å‹åï¼ˆç±»å‹åˆ«åï¼‰ | âœ…               |
