## Rust è¿ç®—ç¬¦é‡è½½ï¼š

Rust æ²¡æœ‰é­”æ³•èˆ¬çš„è¿ç®—ç¬¦é‡è½½è¯­æ³•ï¼Œè€Œæ˜¯é€šè¿‡ **Trait å®ç°**å®‰å…¨ã€æ˜ç¡®åœ°é‡è½½è¿ç®—ç¬¦ã€‚æ ¸å¿ƒæ€æƒ³ï¼š**æ¯ä¸ªè¿ç®—ç¬¦å¯¹åº”ä¸€ä¸ª Traitï¼Œå®ç°å®ƒå³å¯è‡ªå®šä¹‰è¡Œä¸º**ã€‚ä¸‹é¢ç”¨æœ€ç›´ç™½çš„æ–¹å¼è®²é€æ‰€æœ‰å…³é”®ç‚¹ï¼

---

### ä¸ºä»€ä¹ˆéœ€è¦è¿ç®—ç¬¦é‡è½½ï¼Ÿ

è®©è‡ªå®šä¹‰ç±»å‹ï¼ˆå¦‚ `Point`ï¼‰ä¹Ÿèƒ½åƒ `i32` ä¸€æ ·ä½¿ç”¨ `+`ã€`-` ç­‰è¿ç®—ç¬¦ï¼Œä»£ç æ›´ç›´è§‚ï¼š

```rust
let p1 = Point {x: 1, y: 2};
let p2 = Point {x: 3, y: 4};
let p3 = p1 + p2; // å¸Œæœ›å¾—åˆ° Point {x:4, y:6}
```

---

### æ ¸å¿ƒæœºåˆ¶ï¼šTrait é©±åŠ¨

Rust å°†è¿ç®—ç¬¦ç»‘å®šåˆ° `std::ops`, `std::cmp` æ¨¡å—ä¸­çš„ **Trait**ã€‚é‡è½½ç­‰äºä¸ºä½ çš„ç±»å‹å®ç°å¯¹åº” Traitï¼

#### é‡è½½æ­¥éª¤ï¼ˆä¸‡èƒ½å…¬å¼ï¼‰ï¼š

1. **é€‰ Trait**ï¼šæ ¹æ®è¿ç®—ç¬¦æŸ¥å¯¹åº” Traitï¼ˆè§ä¸‹æ–¹é€ŸæŸ¥è¡¨ï¼‰
2. **å®ç° Trait**ï¼šåœ¨ `impl` å—ä¸­å®šä¹‰è¿ç®—é€»è¾‘
3. **æŒ‡å®š Output**ï¼šå£°æ˜è¿ç®—ç»“æœç±»å‹ï¼ˆå…³é”®ï¼ï¼‰

---

### ç¤ºä¾‹ï¼šé‡è½½ `+` è¿ç®—ç¬¦

#### åœºæ™¯ï¼šè®© `Point` ç»“æ„ä½“æ”¯æŒ `+`

```rust
use std::ops::Add; // 1. å¯¼å…¥ Trait

#[derive(Debug)]
struct Point {
    x: i32,
    y: i32,
}

// 2. å®ç° Add Trait
impl Add for Point {
    type Output = Point; // 3. æŒ‡å®šç»“æœç±»å‹ï¼ˆå¿…é¡»ï¼ï¼‰

    // å®šä¹‰ + çš„è¡Œä¸ºï¼šx å’Œ y åˆ†åˆ«ç›¸åŠ 
    fn add(self, other: Point) -> Point {
        Point {
            x: self.x + other.x,
            y: self.y + other.y,
        }
    }
}

fn main() {
    let p1 = Point {x: 1, y: 2};
    let p2 = Point {x: 3, y: 4};
    let p3 = p1 + p2; // è‡ªåŠ¨è°ƒç”¨ add æ–¹æ³•
    println!("{:?}", p3); // è¾“å‡º: Point { x: 4, y: 6 }
}
```

#### å…³é”®ç»†èŠ‚ï¼š

- **`type Output` å¿…é¡»å£°æ˜**ï¼šå‘Šè¯‰ç¼–è¯‘å™¨ `+` çš„ç»“æœæ˜¯ä»€ä¹ˆç±»å‹ï¼ˆå¯ä»¥æ˜¯å…¶ä»–ç±»å‹ï¼Œå¦‚ `Point + i32`ï¼‰
- **å‚æ•°æ‰€æœ‰æƒ**ï¼šé»˜è®¤æ¶ˆè€— `self`ï¼ˆå€¼ä¼ é€’ï¼‰ï¼Œå¦‚éœ€ä¿ç•™åŸå€¼æ”¹ç”¨ `&self`ï¼ˆè§ä¸‹æ–‡æ‰©å±•ï¼‰

---

### å¸¸è§è¿ç®—ç¬¦é‡è½½é€ŸæŸ¥è¡¨

| è¿ç®—ç¬¦ | Trait       | æ–¹æ³•ç­¾å                               | é€‚ç”¨åœºæ™¯                    |
| ------ | ----------- | -------------------------------------- | --------------------------- |
| `+`    | `Add`       | `fn add(self, rhs) -> Self::Output`    | äºŒå…ƒåŠ æ³•                    |
| `-`    | `Sub`       | `fn sub(self, rhs) -> Self::Output`    | äºŒå…ƒå‡æ³•                    |
| `*`    | `Mul`       | `fn mul(self, rhs) -> Self::Output`    | ä¹˜æ³•                        |
| `/`    | `Div`       | `fn div(self, rhs) -> Self::Output`    | é™¤æ³•                        |
| `%`    | `Rem`       | `fn rem(self, rhs) -> Self::Output`    | å–æ¨¡                        |
| `-`    | `Neg`       | `fn neg(self) -> Self::Output`         | **ä¸€å…ƒè´Ÿå·**ï¼ˆå¦‚ `-point`ï¼‰ |
| `!`    | `Not`       | `fn not(self) -> Self::Output`         | é€»è¾‘é                      |
| `&`    | `BitAnd`    | `fn bitand(self, rhs) -> Self::Output` | ä½ä¸                        |
| `+=`   | `AddAssign` | `fn add_assign(&mut self, rhs)`        | **èµ‹å€¼è¿ç®—ç¬¦**ï¼ˆå…³é”®ï¼ï¼‰    |

#### é‡è¦æ‰©å±•ï¼š

1. **å¼•ç”¨é‡è½½ï¼ˆä¿ç•™åŸå€¼ï¼‰**  
   é»˜è®¤ `add(self)` ä¼šæ¶ˆè€—åŸå€¼ï¼Œå¦‚éœ€ä¿ç•™ï¼š

   ```rust
   impl Add for &Point { // ç”¨å¼•ç”¨å®ç°
       type Output = Point;
       fn add(self, other: &Point) -> Point {
           Point { x: self.x + other.x, y: self.y + other.y }
       }
   }
   // ä½¿ç”¨ï¼šp1 + p2 ä¾ç„¶æœ‰æ•ˆï¼ˆè‡ªåŠ¨è§£å¼•ç”¨ï¼‰
   ```

2. **é‡è½½èµ‹å€¼è¿ç®—ç¬¦ï¼ˆå¦‚ `+=`ï¼‰**  
   éœ€å®ç° `*Assign` Traitï¼ˆå‚æ•°å¿…é¡»æ˜¯ `&mut self`ï¼‰ï¼š

   ```rust
   use std::ops::AddAssign;

   impl AddAssign for Point {
       fn add_assign(&mut self, other: Point) {
           self.x += other.x;
           self.y += other.y;
       }
   }

   fn main() {
       let mut p = Point {x:1, y:2};
       p += Point {x:3, y:4}; // âœ… ä¿®æ”¹ p è‡ªèº«
   }
   ```

3. **æ··åˆç±»å‹è¿ç®—ï¼ˆå¦‚ `Point + i32`ï¼‰**  
   é€šè¿‡ `Rhs` æ³›å‹æŒ‡å®šå³ä¾§ç±»å‹ï¼š

   ```rust
   impl Add<i32> for Point { // Point + i32
       type Output = Point;
       fn add(self, rhs: i32) -> Point {
           Point { x: self.x + rhs, y: self.y + rhs }
       }
   }
   ```

4. **æ¯”è¾ƒè¿ç®—ç¬¦é‡è½½**  
   é€šè¿‡ `PartialEq` / `PartialOrd` å®ç° `==`ã€`<` ç­‰ï¼š

   ```rust
   use std::cmp::PartialEq;

   impl PartialEq for Point {
       fn eq(&self, other: &Self) -> bool {
           self.x == other.x && self.y == other.y
       }
   }
   // ç°åœ¨å¯ä»¥å†™ p1 == p2
   ```

---

### å¿…é¡»çŸ¥é“çš„æ³¨æ„äº‹é¡¹

1. **ä¸èƒ½é‡è½½çš„è¿ç®—ç¬¦**  
   `&&`ã€`||`ï¼ˆçŸ­è·¯æ±‚å€¼ï¼‰ã€`=`ï¼ˆèµ‹å€¼ï¼‰ã€`..`ï¼ˆèŒƒå›´ï¼‰**æ— æ³•é‡è½½**ï¼Œè¿™æ˜¯ Rust çš„å®‰å…¨è®¾è®¡ã€‚

2. **Output ç±»å‹å¿…é¡»åŒ¹é…**  
   å¦‚æœ `Add` çš„ `Output` ä¸æ˜¯ `Point`ï¼Œåˆ™ `p1 + p2` ä¼šè¿”å›å…¶ä»–ç±»å‹ï¼ˆå¦‚ `f32`ï¼‰ï¼š

   ```rust
   impl Add for Point {
       type Output = f32;
       fn add(self, other: Point) -> f32 {
           ((self.x - other.x).pow(2) + (self.y - other.y).pow(2)) as f32
       }
   }
   // p1 + p2 è¿”å›ä¸¤ç‚¹é—´è·ç¦»ï¼ˆæµ®ç‚¹æ•°ï¼‰
   ```

3. **ä¿æŒè¯­ä¹‰åˆç†**  
   Rust ç¤¾åŒºåŸåˆ™ï¼š**é‡è½½åº”ç¬¦åˆç›´è§‰**ã€‚  
   âœ… å¥½ï¼š`Vector + Vector` = å‘é‡åŠ æ³•  
   âŒ åï¼š`String + String` = æ‹¼æ¥ï¼ˆRust ç”¨ `+` å®ç°æ‹¼æ¥æ˜¯ç‰¹ä¾‹ï¼Œéå¸¸è§„åšæ³•ï¼‰

4. **Trait å¿…é¡»å¯¼å…¥**  
   æ¯æ¬¡é‡è½½å‰è®°å¾—ï¼š`use std::ops::{Add, Sub, ...};`

---

### ğŸ’¡ ä¸€å¥è¯æ€»ç»“

> **Rust è¿ç®—ç¬¦é‡è½½ç­‰äºä¸ºä½ çš„ç±»å‹å®ç° `std::ops`ï¼Œ`std::cmp` ä¸­çš„ Trait**

---

### å®Œæ•´å®è·µï¼šä»é›¶é‡è½½ `+` å’Œ `+=`

```rust
use std::ops::{Add, AddAssign};

#[derive(Debug)]
struct Vector(i32, i32);

// é‡è½½ + (è¿”å›æ–°å¯¹è±¡)
impl Add for Vector {
    type Output = Vector;
    fn add(self, rhs: Vector) -> Vector {
        Vector(self.0 + rhs.0, self.1 + rhs.1)
    }
}

// é‡è½½ += (ä¿®æ”¹è‡ªèº«)
impl AddAssign for Vector {
    fn add_assign(&mut self, rhs: Vector) {
        self.0 += rhs.0;
        self.1 += rhs.1;
    }
}

fn main() {
    let v1 = Vector(1, 2);
    let v2 = Vector(3, 4);

    // ä½¿ç”¨ +
    let v3 = v1 + v2;
    println!("{:?}", v3); // Vector(4, 6)

    // ä½¿ç”¨ +=
    let mut v4 = Vector(5, 6);
    v4 += Vector(1, 1);
    println!("{:?}", v4); // Vector(6, 7)
}
```
