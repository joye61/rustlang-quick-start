# 函数的基本定义

Rust 中使用 `fn` 关键字定义函数：

```rust
fn 函数名(参数列表) -> 返回类型 {
    // 函数体
}
```

* **函数名**：小写字母，多个单词用下划线 `_` 连接（snake_case）。
* **参数列表**：每个参数必须声明类型。
* **返回类型**：可选，如果函数不返回值，默认返回单元类型 `()`。
* **函数体**：最后一个表达式可以作为返回值，不需要 `return`。

```rust
fn add(a: i32, b: i32) -> i32 {
    a + b // 最后一个表达式作为返回值
}
```

## 调用函数

```rust
fn main() {
    let result = add(2, 3);
    println!("2 + 3 = {}", result); // 输出 5
}
```

---

## 参数与返回值

### 参数

* Rust **函数参数是不可变的**，默认不能修改。
* 如果需要可变参数，可以使用 `mut`：

```rust
fn increment(mut x: i32) -> i32 {
    x += 1;
    x
}
```

### 返回值

* Rust 函数可以返回任意类型。
* **最后一个表达式是返回值**，无需 `return`：

```rust
fn square(x: i32) -> i32 {
    x * x
}
```

* 也可以显式使用 `return`：

```rust
fn cube(x: i32) -> i32 {
    return x * x * x;
}
```

---

## 无返回值函数

函数没有返回值，类型为 `()`（单元类型）。

```rust
fn greet(name: &str) {
    println!("Hello, {}!", name);
}
```

---

## 函数的作用域与嵌套函数

* Rust 不支持在函数内直接定义命名函数，但支持闭包（见下）。
* 函数作用域严格，变量必须先声明。

---

## 函数参数多样性

### 默认参数

* Rust **不支持默认参数**，可用 **可选参数或函数重载模式**：

```rust
fn print_message(msg: Option<&str>) {
    let message = msg.unwrap_or("Hello");
    println!("{}", message);
}
```

### 可变数量参数

* Rust 没有直接的 varargs，可以用 slice：

```rust
fn sum(numbers: &[i32]) -> i32 {
    numbers.iter().sum()
}

fn main() {
    let nums = [1, 2, 3];
    println!("sum = {}", sum(&nums));
}
```

---

## 高阶函数与函数指针

### 函数作为参数

```rust
fn apply<F>(x: i32, f: F) -> i32
where
    F: Fn(i32) -> i32,
{
    f(x)
}

fn double(n: i32) -> i32 { n * 2 }

fn main() {
    let result = apply(5, double);
    println!("result = {}", result); // 10
}
```

### 函数返回函数

```rust
fn create_adder(x: i32) -> impl Fn(i32) -> i32 {
    move |y| x + y
}

fn main() {
    let add5 = create_adder(5);
    println!("{}", add5(3)); // 8
}
```

---

## 函数指针

Rust 可以使用函数指针类型 `fn`：

```rust
fn square(x: i32) -> i32 { x * x }

fn main() {
    let f: fn(i32) -> i32 = square;
    println!("f(4) = {}", f(4)); // 16
}
```


## 函数总结

| 特性     | 说明                            |
| ------ | ----------------------------- |
| 定义关键字  | `fn`                          |
| 参数类型要求 | 必须声明类型，默认不可变                  |
| 返回值    | 可指定类型，最后一个表达式为返回值；无返回值默认 `()` |
| 可变参数   | 使用 `mut` 声明；多参数用 slice        |
| 高阶函数   | 可以将函数作为参数或返回函数                |
| 函数指针   | 类型为 `fn`，可赋值、调用               |


