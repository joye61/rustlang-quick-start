# Traitï¼ˆç‰¹å¾ï¼‰

> Trait æ˜¯ Rust çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œç±»ä¼¼å…¶ä»–è¯­è¨€çš„â€œæ¥å£â€æˆ–â€œç±»å‹ç±»â€ã€‚å®ƒå®šä¹‰äº†ä¸€ç»„å¯ä»¥è¢«å®ç°çš„**è¡Œä¸ºè§„èŒƒ**ã€‚

---

## ğŸ”¹ ä»€ä¹ˆæ˜¯ Traitï¼Ÿ

Trait å°±æ˜¯ä¸€ä¸ªè¡Œä¸ºâ€œçº¦å®šâ€ï¼Œè°å®ç°äº†å®ƒï¼Œè°å°±å…·å¤‡äº†è¿™å¥—åŠŸèƒ½ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå¯ä»¥â€œå«â€çš„ Traitï¼š

```rust
trait Speak {
    fn speak(&self);
}
```

### è°æ¥å®ç°ï¼Ÿ

```rust
struct Dog;

impl Speak for Dog {
    fn speak(&self) {
        println!("æ±ªæ±ªï¼");
    }
}
```

---

## ğŸ›  åŸºæœ¬è¯­æ³•

### å®šä¹‰ Trait

```rust
trait TraitName {
    fn method_name(&self); // æ— é»˜è®¤å®ç°
}
```

### å®ç° Trait

```rust
impl TraitName for TypeName {
    fn method_name(&self) {
        // å®ç°é€»è¾‘
    }
}
```

---

## ğŸŒŸ ç¤ºä¾‹ï¼šå®šä¹‰å’Œå®ç°ä¸€ä¸ª Trait

```rust
trait Hello {
    fn say_hello(&self);
}

struct Person;
struct Robot;

impl Hello for Person {
    fn say_hello(&self) {
        println!("ä½ å¥½ï¼Œæˆ‘æ˜¯äººç±»ï¼");
    }
}

impl Hello for Robot {
    fn say_hello(&self) {
        println!("ä½ å¥½ï¼Œæˆ‘æ˜¯æœºå™¨äººï¼");
    }
}

fn main() {
    let p = Person;
    let r = Robot;

    p.say_hello(); // ä½ å¥½ï¼Œæˆ‘æ˜¯äººç±»ï¼
    r.say_hello(); // ä½ å¥½ï¼Œæˆ‘æ˜¯æœºå™¨äººï¼
}
```

---

## ğŸ”¸ é»˜è®¤å®ç°

ä½ å¯ä»¥ä¸º trait æä¾›é»˜è®¤å®ç°ï¼Œè¿™æ ·å®ç°è€…å¯ä»¥é€‰æ‹©æ˜¯å¦è¦†ç›–å®ƒã€‚

```rust
trait Greet {
    fn greet(&self) {
        println!("Hello!");
    }
}

struct Cat;
impl Greet for Cat {} // ä½¿ç”¨é»˜è®¤å®ç°

fn main() {
    Cat.greet(); // Hello!
}
```

---

## ğŸ”¹ å¸¦è¿”å›å€¼çš„æ–¹æ³•

```rust
trait Area {
    fn area(&self) -> f64;
}

struct Circle {
    radius: f64,
}

impl Area for Circle {
    fn area(&self) -> f64 {
        std::f64::consts::PI * self.radius * self.radius
    }
}
```

---

## ğŸ§© å¤šä¸ª Trait çš„å®ç°

```rust
trait A {
    fn a(&self);
}

trait B {
    fn b(&self);
}

struct Thing;

impl A for Thing {
    fn a(&self) { println!("A"); }
}

impl B for Thing {
    fn b(&self) { println!("B"); }
}
```

---

## ğŸ¯ Trait Boundï¼ˆç‰¹å¾çº¦æŸï¼‰

å¯ä»¥å°† trait ä½œä¸ºå‡½æ•°å‚æ•°çš„ç±»å‹çº¦æŸï¼š

### å†™æ³• 1ï¼šåœ¨å‚æ•°å¤„ä½¿ç”¨ `impl Trait`

```rust
fn print_speak(x: impl Speak) {
    x.speak();
}
```

### å†™æ³• 2ï¼šä½¿ç”¨æ³›å‹ + `T: Trait`

```rust
fn print_speak<T: Speak>(x: T) {
    x.speak();
}
```

### å†™æ³• 3ï¼šä½¿ç”¨ where å­å¥ï¼ˆæ›´æ¸…æ™°ï¼‰

```rust
fn print_speak<T>(x: T)
where
    T: Speak,
{
    x.speak();
}
```

---

## ğŸ” å¤šä¸ª Trait Boundï¼ˆç»„åˆçº¦æŸï¼‰

```rust
fn show<T: Speak + std::fmt::Debug>(x: T) {
    x.speak();
    println!("{:?}", x);
}
```

---

## âœ… Trait Objectï¼ˆç‰¹å¾å¯¹è±¡ï¼‰

å¦‚æœä½ æƒ³è®©ä¸€ä¸ªå˜é‡â€œæŒ‡å‘ä¸åŒå®ç°ç±»å‹â€ï¼Œéœ€è¦ç”¨ **trait å¯¹è±¡ + åŠ¨æ€åˆ†å‘**ï¼š

```rust
trait Speak {
    fn speak(&self);
}

struct Dog;
impl Speak for Dog {
    fn speak(&self) { println!("ç‹—å«ï¼"); }
}

struct Cat;
impl Speak for Cat {
    fn speak(&self) { println!("çŒ«å«ï¼"); }
}

fn make_speak_list() -> Vec<Box<dyn Speak>> {
    vec![Box::new(Dog), Box::new(Cat)]
}

fn main() {
    for animal in make_speak_list() {
        animal.speak(); // åŠ¨æ€è°ƒç”¨
    }
}
```

### æ³¨æ„äº‹é¡¹ï¼š

* `Box<dyn Trait>` æ˜¯**ç‰¹å¾å¯¹è±¡**ï¼›
* åªæœ‰åœ¨ **Trait æ²¡æœ‰æ³›å‹å‚æ•°**æ—¶ï¼Œæ‰èƒ½ä½œä¸º trait å¯¹è±¡ï¼›
* è¿è¡Œæ—¶ä½¿ç”¨â€œåŠ¨æ€åˆ†å‘â€ï¼Œç¨æ…¢ä½†æ›´çµæ´»ã€‚

---

## ğŸš€ Trait ä½œä¸ºè¿”å›å€¼

```rust
fn make_speaker() -> impl Speak {
    Dog
}
```

âš ï¸ æ³¨æ„ï¼š`impl Trait` åªèƒ½è¿”å› **ä¸€ç§å®ç°ç±»å‹**ã€‚

---

## å…³è”ç±»å‹ï¼ˆAssociated Typesï¼‰

åœ¨ Trait ä¸­å®šä¹‰ç±»å‹å ä½ç¬¦ï¼š

```rust
trait Iterator {
    type Item;
    fn next(&mut self) -> Option<Self::Item>;
}
```

å®ç°æ—¶å¿…é¡»è¦æŒ‡å®š `Item` ç±»å‹ï¼š

```rust
struct Counter;

impl Iterator for Counter {
    type Item = i32;

    fn next(&mut self) -> Option<i32> {
        Some(42)
    }
}
```

## trait ç»§æ‰¿ï¼Ÿ

ç®€å•ç‚¹è¯´å°±æ˜¯ï¼š**ä¸€ä¸ª trait ç»§æ‰¿å¦ä¸€ä¸ª trait çš„èƒ½åŠ›**ã€‚

```rust
trait A {
    fn a(&self);
}

trait B: A {
    // è¿™é‡Œå¯ä»¥ç›´æ¥ç”¨ A çš„æ–¹æ³•
    fn b(&self) {
        println!("b calls a:");
        self.a(); // ç›´æ¥ç”¨ A çš„æ–¹æ³•
    }
}

```

ä½†å’Œå…¶ä»–ç¼–ç¨‹è¯­è¨€çš„é¢å‘å¯¹è±¡ç»§æ‰¿ä¸åŒçš„æ˜¯ï¼š**ä»»ä½•å®ç° B çš„ç±»å‹ï¼Œä¹Ÿå¿…é¡»åŒæ—¶å®ç° A**

### æ³›å‹ç»§æ‰¿çš„ç®€å•ä¾‹å­

```rust
struct MyType;

impl A for MyType {
    fn a(&self) { println!("hello from A"); }
}

impl B for MyType {}

fn main() {
    let t = MyType;
    t.b(); // è‡ªåŠ¨è°ƒç”¨ a()
}
```

å¿…é¡»åŒæ—¶ä¸º MyType ç±»å‹å®ç° A å’Œ Bï¼Œä¸‹é¢çš„å†™æ³•æ˜¯é”™è¯¯çš„ï¼š

```rust
struct MyType;

impl B for MyType {
    // é‡è¦ï¼šè¿™é‡Œå¹¶æ²¡æœ‰å®ç° Aï¼Œä¸èƒ½åœ¨Bå®ç°é‡Œé¢å®ç°Açš„æ–¹æ³•
    fn a(&self) { println!("hello from A"); }
}

fn main() {
    let t = MyType;
    t.b(); // è‡ªåŠ¨è°ƒç”¨ a()
}
```

---

## ğŸ“¦ ä½¿ç”¨æ ‡å‡†åº“ Trait

Rust æ ‡å‡†åº“ä¸­å¤§é‡ä½¿ç”¨ traitï¼Œæ¯”å¦‚ï¼š

| Trait           | ç”¨é€”               |
| --------------- | ---------------- |
| `Display`       | æ ¼å¼åŒ–è¾“å‡º `{}`       |
| `Debug`         | æ ¼å¼åŒ–è¾“å‡º `{:?}`     |
| `Clone`         | å…‹éš†               |
| `Copy`          | æ‹·è´               |
| `PartialEq`     | ç›¸ç­‰æ¯”è¾ƒ `==`        |
| `PartialOrd`    | å¤§å°æ¯”è¾ƒ `< > >= <=` |
| `From` / `Into` | ç±»å‹è½¬æ¢             |
| `Drop`          | è‡ªå®šä¹‰ææ„            |

### ç¤ºä¾‹ï¼šä¸ºè‡ªå®šä¹‰ç±»å‹å®ç° `Display`

```rust
use std::fmt;

struct Point { x: i32, y: i32 }

impl fmt::Display for Point {
    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {
        write!(f, "({}, {})", self.x, self.y)
    }
}

fn main() {
    let p = Point { x: 1, y: 2 };
    println!("{}", p); // (1, 2)
}
```

---

## Trait çš„é«˜çº§ç”¨æ³•æ¦‚è§ˆ

| ç”¨æ³•           | è¯´æ˜                          |
| ------------ | --------------------------- |
| é»˜è®¤æ–¹æ³•å®ç°       | æä¾›é»˜è®¤é€»è¾‘                      |
| é™æ€åˆ†å‘ vs åŠ¨æ€åˆ†å‘ | `impl Trait` vs `dyn Trait` |
| æ³›å‹çº¦æŸ         | `T: Trait`                  |
| where å­å¥     | `where T: Trait1 + Trait2`  |
| å…³è”ç±»å‹         | `type Item`                 |
| trait + æ³›å‹ç»„åˆ | `trait Iterator<T>`ï¼ˆç›®å‰ä¸ç¨³å®šï¼‰  |
| trait ç»§æ‰¿     | `trait B: A {}`             |
| trait çš„ç”Ÿå‘½å‘¨æœŸ  | `trait TraitName + 'a`      |

