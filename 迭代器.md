# è¿­ä»£å™¨ `Iterator`

## ä»€ä¹ˆæ˜¯è¿­ä»£å™¨ï¼Ÿ

åœ¨ Rust ä¸­ï¼Œ**è¿­ä»£å™¨æ˜¯ä¸€ç§å¯ä»¥é€ä¸ªäº§å‡ºå…ƒç´ çš„å¯¹è±¡**ã€‚å®ƒå°±åƒä¸€ä¸ªâ€œæ•°æ®æµâ€ï¼Œå¯ä»¥ä¸€é¡¹ä¸€é¡¹åœ°â€œå–å‡ºå€¼â€ï¼Œç”¨åœ¨ for å¾ªç¯ã€mapã€filterã€collect ç­‰æ“ä½œä¸­ã€‚

ä¾‹å¦‚ï¼š

```rust
let nums = vec![1, 2, 3];
for n in nums.iter() {
    println!("{}", n);
}
```

## Iterator æ˜¯ä»€ä¹ˆï¼Ÿ

Rust ä¸­çš„ `Iterator` æ˜¯ä¸€ä¸ª traitï¼š

```rust
pub trait Iterator {
    type Item;

    fn next(&mut self) -> Option<Self::Item>;

    // é»˜è®¤å®ç°çš„é€‚é…å™¨æ–¹æ³•ï¼Œä¾‹å¦‚ mapã€filter ç­‰
}
```

> **åªè¦å®ç°äº† `next` æ–¹æ³•çš„ç±»å‹ï¼Œå°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚**


## æœ€åŸºæœ¬çš„è¿­ä»£å™¨ä½¿ç”¨æ–¹å¼

```rust
fn main() {
    let v = vec![10, 20, 30];
    let mut iter = v.iter(); // è·å–ä¸å¯å˜è¿­ä»£å™¨

    println!("{:?}", iter.next()); // Some(10)
    println!("{:?}", iter.next()); // Some(20)
    println!("{:?}", iter.next()); // Some(30)
    println!("{:?}", iter.next()); // None
}
```

## æ€»ç»“

| æ–¹æ³•             | å«ä¹‰                     |
| -------------- | ---------------------- |
| `.iter()`      | è·å–ä¸å¯å˜å¼•ç”¨è¿­ä»£å™¨ï¼Œç±»å‹æ˜¯ `&T`      |
| `.iter_mut()`  | è·å–å¯å˜å¼•ç”¨è¿­ä»£å™¨ï¼Œç±»å‹æ˜¯ `&mut T` |
| `.into_iter()` | è·å–æ‰€æœ‰æƒè¿­ä»£å™¨ï¼Œç±»å‹æ˜¯ `T`       |



## å®ç°ä½ è‡ªå·±çš„è¿­ä»£å™¨

```rust
struct Counter {
    count: usize,
}

impl Counter {
    fn new() -> Self {
        Self { count: 0 }
    }
}

impl Iterator for Counter {
    type Item = usize;

    fn next(&mut self) -> Option<Self::Item> {
        self.count += 1;
        if self.count <= 5 {
            Some(self.count)
        } else {
            None
        }
    }
}

fn main() {
    let mut c = Counter::new();
    while let Some(n) = c.next() {
        println!("{}", n);
    }
}
```

## æ€»ç»“

* å®ç° `Iterator` è¦å®šä¹‰ `type Item` å’Œ `next` æ–¹æ³•ã€‚
* `next` æ¯æ¬¡è¿”å› `Some(item)`ï¼Œæ²¡æœ‰å€¼æ—¶è¿”å› `None`ã€‚
* ä½ å¯ä»¥è‡ªå®šä¹‰ä»»ä½•äº§ç”Ÿåºåˆ—çš„é€»è¾‘ã€‚

---

## å¸¸è§é€‚é…å™¨æ–¹æ³•ï¼ˆmapã€filterã€takeã€collect ç­‰ï¼‰

### `.map()`

```rust
fn main() {
    let v = vec![1, 2, 3];
    let doubled: Vec<_> = v.iter().map(|x| x * 2).collect();
    println!("{:?}", doubled); // [2, 4, 6]
}
```

> `Vec<_>` è¡¨ç¤ºï¼šè®©ç¼–è¯‘å™¨**è‡ªåŠ¨æ¨å¯¼**å‡º `Vec<T>` ä¸­çš„ `T` æ˜¯ä»€ä¹ˆç±»å‹

### `.filter()`

```rust
fn main() {
    let v = vec![1, 2, 3, 4];
    let evens: Vec<_> = v.into_iter().filter(|x| x % 2 == 0).collect();
    println!("{:?}", evens); // [2, 4]
}
```

### `.take(n)`ï¼šåªå–å‰ n ä¸ªå…ƒç´ 

```rust
fn main() {
    let nums = 1..;
    let first_five: Vec<_> = nums.take(5).collect();
    println!("{:?}", first_five); // [1, 2, 3, 4, 5]
}
```

### `.collect()`ï¼šæ”¶é›†åˆ°é›†åˆä¸­

```rust
fn main() {
    let squares = (1..=4).map(|x| x * x).collect::<Vec<_>>();
    println!("{:?}", squares); // [1, 4, 9, 16]
}
```


## ğŸ”‚ å››ã€æ‰€æœ‰å¸¸è§ Iterator æ–¹æ³•ä¸€è§ˆï¼ˆé€‚é…å™¨/æ¶ˆè´¹è€…ï¼‰

### ğŸ“¦ é€‚é…å™¨æ–¹æ³•ï¼ˆè¿”å›å¦ä¸€ä¸ªè¿­ä»£å™¨ï¼‰ï¼š

* `.map()`
* `.filter()`
* `.enumerate()`
* `.skip(n)`
* `.take(n)`
* `.rev()`
* `.zip(other_iter)`
* `.chain(other_iter)`
* `.flat_map()`

### ğŸ¯ æ¶ˆè´¹è€…æ–¹æ³•ï¼ˆç»“æŸè¿­ä»£å¹¶è¿”å›ç»“æœï¼‰ï¼š

* `.collect()`
* `.sum()`
* `.product()`
* `.find()`
* `.any()` / `.all()`
* `.fold(init, f)`
* `.for_each()`
* `.count()`
* `.max()` / `.min()`

---

## âœï¸ äº”ã€`.into_iter()` çš„å‘ç‚¹ï¼ˆç‰¹åˆ«æ˜¯ for å¾ªç¯ï¼‰

### ç¤ºä¾‹ï¼š

```rust
fn main() {
    let v = vec![1, 2, 3];

    for x in v.iter() {
        println!("borrow: {}", x); // x æ˜¯ &i32
    }

    for x in v.into_iter() {
        println!("own: {}", x); // x æ˜¯ i32
    }

    let mut v2 = vec![1, 2, 3];
    for x in v2.iter_mut() {
        *x += 10;
    }
    println!("{:?}", v2); // [11, 12, 13]
}
```

### âœ… æ€»ç»“ï¼š

| æ–¹æ³•             | è¿”å›å…ƒç´ ç±»å‹   | æ˜¯å¦æ¶ˆè€—é›†åˆ  |
| -------------- | -------- | ------- |
| `.iter()`      | `&T`     | âŒ       |
| `.iter_mut()`  | `&mut T` | âŒ       |
| `.into_iter()` | `T`      | âœ… ä¼šæ¶ˆè€—é›†åˆ |

---

## ğŸš€ å…­ã€ä¸ `for` å¾ªç¯çš„å…³ç³»

Rust çš„ `for x in iter {}` æ˜¯è¯­æ³•ç³–ï¼š

```rust
let mut iter = some_iter;
while let Some(x) = iter.next() {
    // do something
}
```

æ‰€ä»¥ä½ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å®ç°äº† `Iterator` çš„ç±»å‹ï¼Œç›´æ¥ç”¨äº `for` å¾ªç¯ã€‚

---

## ğŸ§  ä¸ƒã€`.by_ref()` çš„å¦™ç”¨

å½“ä½ æƒ³åœ¨ä¸€ä¸ªæ–¹æ³•é“¾ä¸­â€œä¸­é€”æ‹¿èµ°è¿­ä»£å™¨â€ä½†åˆæƒ³ç»§ç»­ç”¨å®ƒï¼Œå¯ä»¥ç”¨ `.by_ref()`ï¼š

```rust
fn main() {
    let mut iter = 1..=10;

    let first_half: Vec<_> = iter.by_ref().take(5).collect();
    let second_half: Vec<_> = iter.collect();

    println!("{:?}", first_half);  // [1, 2, 3, 4, 5]
    println!("{:?}", second_half); // [6, 7, 8, 9, 10]
}
```

---

## ğŸ› ï¸ å…«ã€`.fold()` ä¸ `.reduce()`

### `.fold()`ï¼šç´¯åŠ å™¨ï¼ˆåˆå§‹å€¼ + é—­åŒ…ï¼‰

```rust
fn main() {
    let sum = (1..=5).fold(0, |acc, x| acc + x);
    println!("{}", sum); // 15
}
```

### `.reduce()`ï¼šä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹æŠ˜å ï¼ˆæ— åˆå§‹å€¼ï¼‰

```rust
fn main() {
    let max = (1..=5).reduce(|a, b| a.max(b));
    println!("{:?}", max); // Some(5)
}
```

---

## ğŸ§® ä¹ã€`.enumerate()` å’Œ `.zip()`

```rust
fn main() {
    let v = vec!["a", "b", "c"];
    for (i, val) in v.iter().enumerate() {
        println!("{}: {}", i, val);
    }

    let names = ["Alice", "Bob"];
    let ages = [20, 25];
    for (name, age) in names.iter().zip(ages.iter()) {
        println!("{} is {}", name, age);
    }
}
```

---

## âœ… æœ€ç»ˆæ€»ç»“ï¼šIterator çš„æ ¸å¿ƒè¦ç‚¹

| å†…å®¹               | è¯´æ˜                                       |
| ---------------- | ---------------------------------------- |
| `Iterator` trait | å®šä¹‰äº† `next()` æ–¹æ³•ï¼Œç”¨äºé€ä¸ªäº§å‡ºå…ƒç´                  |
| é€‚é…å™¨æ–¹æ³•            | `.map()`ã€`.filter()`ã€`.take()` ç­‰è¿”å›æ–°çš„è¿­ä»£å™¨  |
| æ¶ˆè´¹è€…æ–¹æ³•            | `.collect()`ã€`.sum()`ã€`.count()` ç­‰è¿”å›æœ€ç»ˆç»“æœ |
| æ‰€æœ‰æƒè§„åˆ™            | `.iter()` ä¸æ¶ˆè€—ï¼Œ`.into_iter()` ä¼šè½¬ç§»æ‰€æœ‰æƒ      |
| å¯è‡ªå®šä¹‰å®ç°           | åªéœ€å®ç° `next()` æ–¹æ³•å³å¯                       |
| ä¸ for é…åˆ         | `for x in iter` è‡ªåŠ¨è°ƒç”¨ `next()`ï¼Œæ— éœ€æ‰‹å†™       |

---