# 运算符与操作符

## 算术运算符（Arithmetic Operators）

Rust 支持整数、浮点数等算术运算，所有算术运算符都会返回对应类型结果。

| 运算符 | 功能 | 类型限制 | 示例                     | 注意事项                                    |
| --- | -- | ---- | ---------------------- | --------------------------------------- |
| `+` | 加法 | 数值   | `let x = 5 + 3; // 8`  | 溢出会 panic（在 debug 模式），release 模式会环绕     |
| `-` | 减法 | 数值   | `let x = 5 - 8; // -3` | 同上                                      |
| `*` | 乘法 | 数值   | `let x = 4 * 2; // 8`  | 同上                                      |
| `/` | 除法 | 数值   | `5 / 2; // 2`（整数截断）    | 整数除以 0 会 panic，浮点除以 0 结果为 `inf` 或 `NaN` |
| `%` | 取余 | 数值   | `5 % 2; // 1`          | 符号遵循被除数符号，`-5 % 2 == -1`                |
| `-` | 负号 | 数值   | `let x = -5;`          | 一元运算符                                   |
| `+` | 正号 | 数值   | `let x = +5;`          | 通常不用                                    |


## 赋值运算符（Assignment Operators）

赋值运算符用于给可变变量 `mut` 赋值或累加、累减等。

| 运算符   | 功能     | 示例                       | 注意事项                      |             |    |
| ----- | ------ | ------------------------ | ------------------------- | ----------- | -- |
| `=`   | 直接赋值   | `let mut x = 5;`         | 必须声明 `mut` 可变             |             |    |
| `+=`  | 累加赋值   | `x += 3; // x = x + 3`   | 类型必须匹配                    |             |    |
| `-=`  | 累减赋值   | `x -= 2;`                | 同上                        |             |    |
| `*=`  | 累乘赋值   | `x *= 4;`                | 同上                        |             |    |
| `/=`  | 累除赋值   | `x /= 2;`                | 整数除以 0 会 panic            |             |    |
| `%=`  | 累模赋值   | `x %= 3;`                | 同上                        |             |    |
| `<<=` | 左移赋值   | `x <<= 1; // x = x << 1` | 左移右值类型通常是 `u32` 或 `usize` |             |    |
| `>>=` | 右移赋值   | `x >>= 1; // x = x >> 1` | 有符号数右移保持符号                |             |    |
| `&=`  | 按位与赋值  | `x &= 0b1010;`           | 仅整数有效                     |             |    |
| \`    | =\`    | 按位或赋值                    | \`x                       | = 0b0101;\` | 同上 |
| `^=`  | 按位异或赋值 | `x ^= 0b0011;`           | 同上                        |             |    |

## 比较运算符（Comparison Operators）

返回布尔值 `bool`。

| 运算符  | 功能   | 示例                 | 注意事项        |
| ---- | ---- | ------------------ | ----------- |
| `==` | 等于   | `5 == 5; // true`  | 不允许不同类型直接比较 |
| `!=` | 不等于  | `5 != 3; // true`  | 同上          |
| `<`  | 小于   | `5 < 3; // false`  | 同上          |
| `>`  | 大于   | `5 > 3; // true`   | 同上          |
| `<=` | 小于等于 | `5 <= 5; // true`  | 同上          |
| `>=` | 大于等于 | `5 >= 6; // false` | 同上          |

Rust 中 `==` 与 `PartialEq` trait 相关，自定义类型需要实现此 trait 才能使用。


## 逻辑运算符（Logical Operators）

| 运算符  | 功能    | 示例                        | 注意事项             |        |   |                  |                 |
| ---- | ----- | ------------------------- | ---------------- | ------ | - | ---------------- | --------------- |
| `&&` | 与（短路） | `true && false; // false` | 左边为 false 时右边不执行 |        |   |                  |                 |
| \`   |       | \`                        | 或（短路）            | \`true |   | false; // true\` | 左边为 true 时右边不执行 |
| `!`  | 非     | `!true; // false`         | 只作用于布尔类型         |        |   |                  |                 |

## 位运算符（Bitwise Operators）

只适用于整数类型（`i*` 或 `u*`）。

| 运算符  | 功能   | 示例                           | 注意事项                |                     |    |
| ---- | ---- | ---------------------------- | ------------------- | ------------------- | -- |
| `&`  | 按位与  | `0b1100 & 0b1010; // 0b1000` | 两个操作数必须同类型          |                     |    |
| \`   | \`   | 按位或                          | \`0b1100            | 0b1010; // 0b1110\` | 同上 |
| `^`  | 按位异或 | `0b1100 ^ 0b1010; // 0b0110` | 同上                  |                     |    |
| `!`  | 按位取反 | `!0b1100;`                   | 返回补码表示              |                     |    |
| `<<` | 左移   | `0b0001 << 2; // 0b0100`     | 右值为 `u32` 或 `usize` |                     |    |
| `>>` | 右移   | `0b1000 >> 2; // 0b0010`     | 有符号数保留符号位           |                     |    |


## 索引与切片操作符

| 运算符   | 功能          | 示例                  | 注意事项                |
| ----- | ----------- | ------------------- | ------------------- |
| `[]`  | 索引数组/切片/字符串 | `arr[0];`           | 越界会 panic           |
| `..`  | 范围          | `0..3; // 0,1,2`    | 常用于 `for i in 0..3` |
| `..=` | 包含右边界范围     | `0..=3; // 0,1,2,3` | 同上                  |
| `..`  | 到头范围        | `..3`、`3..`         | 常用于切片               |
| `_`   | 占位符         | `let _ = arr[0];`   | 表示忽略值               |


## 解引用与引用运算符

| 运算符    | 功能       | 示例                | 注意事项          |
| ------ | -------- | ----------------- | ------------- |
| `&`    | 取引用      | `let r = &x;`     | 返回引用，不改变所有权   |
| `&mut` | 可变引用     | `let r = &mut x;` | 同一时间只允许一个可变引用 |
| `*`    | 解引用      | `*r = 10;`        | 修改引用指向的值      |
| `ref`  | 模式匹配引用绑定 | `let ref y = x;`  | 匹配时创建引用而不是移动  |


## 函数调用、方法调用、命名空间访问

| 运算符  | 功能        | 示例                           | 注意事项                 |
| ---- | --------- | ---------------------------- | -------------------- |
| `()` | 函数调用/元组访问 | `foo()`、`(a,b).0`            | 元组下标从 0 开始           |
| `.`  | 方法或字段访问   | `s.field`                    | 适用于结构体、枚举方法、trait 方法 |
| `::` | 命名空间访问    | `std::mem::size_of::<i32>()` | 访问模块、类型、trait        |


## 错误传播运算符

| 运算符 | 功能   | 示例                                                         | 注意事项                           |
| --- | ---- | ---------------------------------------------------------- | ------------------------------ |
| `?` | 错误传播 | `fn foo() -> Result<i32, Error> { let x = bar()?; Ok(x) }` | 只能用于返回 `Result` 或 `Option` 的函数 |


## 类型转换运算符

| 运算符  | 功能   | 示例                  | 注意事项                    |
| ---- | ---- | ------------------- | ----------------------- |
| `as` | 类型转换 | `let x = 5 as f64;` | 可以转换整型、浮点、指针等，但可能截断或丢精度 |


## 结构体更新语法

| 运算符  | 功能    | 示例                         | 注意事项               |
| ---- | ----- | -------------------------- | ------------------ |
| `..` | 结构体更新 | `Struct { a: 1, ..other }` | 表示其余字段与 `other` 相同 |


## 运算符优先级（核心）

从高到低：

1. `()`、`[]`、`.`、`::`、`?`
2. `!`、`*`（解引用）、`-`（负号）
3. `*` `/` `%`
4. `+` `-`
5. `<<` `>>`
6. `&`
7. `^`
8. `|`
9. `&&`
10. `||`
11. 比较运算符 `< <= > >= == !=`
12. 赋值 `=, +=, -= ...`

使用括号可以避免优先级错误，并增强可读性。


## 综合示例

```rust
fn main() {
    let mut x: i32 = 5;
    let y: i32 = 3;

    // 算术 + 赋值
    x += y * 2; // x = 5 + 3*2 = 11

    // 比较 + 逻辑
    let z = x > 10 && y < 5; // true

    // 位运算
    let a = 0b1100 & 0b1010; // 0b1000 = 8

    // 索引 + 切片
    let arr = [1,2,3,4];
    let slice = &arr[1..3]; // [2,3]

    // 解引用
    let mut r = &mut x;
    *r += 1; // x = 12

    // 类型转换
    let f = x as f64 / 2.0; // 6.0

    println!("x={}, z={}, a={:?}, slice={:?}, f={}", x, z, a, slice, f);
}
```

输出：

```
x=12, z=true, a=8, slice=[2, 3], f=6
```

