# æ³›å‹ï¼ˆGenericsï¼‰

## ğŸ§  ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ

æ³›å‹ï¼ˆGenericsï¼‰å…è®¸ä½ å†™å‡ºèƒ½é€‚ç”¨äº**å¤šç§ç±»å‹**çš„ä»£ç ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ç§ç±»å‹éƒ½å†™ä¸€éã€‚

æ¯”å¦‚ä½ è¦å†™ä¸€ä¸ªå‡½æ•°æ¯”è¾ƒä¸¤ä¸ªæ•°å¹¶è¿”å›è¾ƒå¤§å€¼ï¼Œå¯ä»¥è¿™æ ·ï¼š

```rust
fn max_i32(a: i32, b: i32) -> i32 {
    if a > b { a } else { b }
}
fn max_f64(a: f64, b: f64) -> f64 {
    if a > b { a } else { b }
}
```

ğŸ‘†ğŸ‘† å¤ªé‡å¤äº†ï¼

### ä½¿ç”¨æ³›å‹ç‰ˆæœ¬ï¼š

```rust
fn max<T: PartialOrd>(a: T, b: T) -> T {
    if a > b { a } else { b }
}
```

`T` æ˜¯ä¸€ä¸ªâ€œ**ç±»å‹å‚æ•°**â€ï¼Œä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œå‡½æ•°çš„â€œç±»å‹å˜é‡â€ã€‚

---

## ğŸ”¹ æ³›å‹è¯­æ³•ç»“æ„

### åœ¨å‡½æ•°ä¸­ä½¿ç”¨æ³›å‹

```rust
fn function_name<T>(arg: T) -> T {
    // ä½¿ç”¨ T ç±»å‹çš„å˜é‡
}
```

* `<T>`ï¼šå®šä¹‰æ³›å‹å‚æ•°ï¼›
* `T`ï¼šåœ¨å‚æ•°ã€è¿”å›å€¼ä¸­ä½¿ç”¨ï¼›
* å¯ç”¨å¤šä¸ªå‚æ•°ï¼Œå¦‚ `<T, U, V>`ã€‚

### ç¤ºä¾‹ï¼šäº¤æ¢ä¸¤ä¸ªå€¼å¹¶è¿”å›å…ƒç»„

```rust
fn swap<T, U>(a: T, b: U) -> (U, T) {
    (b, a)
}

fn main() {
    let result = swap(1, "hello");
    println!("{:?}", result); // ("hello", 1)
}
```

---

## æ³›å‹ç»“æ„ä½“

æ³›å‹ä¹Ÿå¯ä»¥ç”¨åœ¨ç»“æ„ä½“ä¸Šï¼Œè®©ç»“æ„ä½“å­—æ®µæ”¯æŒä¸åŒç±»å‹ã€‚

### ç¤ºä¾‹ï¼š

```rust
struct Point<T> {
    x: T,
    y: T,
}

fn main() {
    let p1 = Point { x: 1, y: 2 };
    let p2 = Point { x: 1.1, y: 2.2 };
}
```

### å¤šä¸ªç±»å‹å‚æ•°ï¼š

```rust
struct Pair<T, U> {
    first: T,
    second: U,
}

let p = Pair { first: "hi", second: 42 };
```

---

## ğŸ”¹ æ³›å‹æšä¸¾

æ¯”å¦‚ Rust æ ‡å‡†åº“ä¸­çš„ `Option<T>`ï¼š

```rust
enum Option<T> {
    Some(T),
    None,
}

let some_number = Option::Some(5);
let some_text = Option::Some("hello");
```

ä½ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ç±»ä¼¼çš„æ³›å‹æšä¸¾ã€‚

---

## ğŸ”¸ æ³›å‹æ–¹æ³• & `impl<T>`

æ³›å‹å¯ä»¥ç”¨äºå®ç°å—ä¸­ï¼š

```rust
struct Point<T> {
    x: T,
    y: T,
}

impl<T> Point<T> {
    fn x(&self) -> &T {
        &self.x
    }
}
```

ä¹Ÿå¯ä»¥åªä¸ºæŸäº›ç±»å‹å®ç°ï¼š

```rust
impl Point<f32> {
    fn distance_from_origin(&self) -> f32 {
        (self.x.powi(2) + self.y.powi(2)).sqrt()
    }
}
```

---

## âš™ï¸ æ³›å‹çº¦æŸï¼ˆTrait Boundsï¼‰

æœ‰äº›æ“ä½œï¼ˆå¦‚æ¯”è¾ƒå¤§å°ï¼‰åªé€‚ç”¨äºå®ç°äº†ç‰¹å®š trait çš„ç±»å‹ï¼Œå› æ­¤ä½ éœ€è¦ **åŠ  trait é™åˆ¶**ã€‚

### ç¤ºä¾‹ï¼š

```rust
fn largest<T: PartialOrd>(a: T, b: T) -> T {
    if a > b { a } else { b }
}
```

ä½ å¯ä»¥ç»™å¤šä¸ªå‚æ•°åŠ å¤šä¸ª traitï¼š

```rust
fn print_debug<T: std::fmt::Debug, U: std::fmt::Display>(t: T, u: U) {
    println!("{:?}, {}", t, u);
}
```

---

## ğŸ§© where å­å¥ï¼šå¯è¯»æ€§æ›´é«˜çš„çº¦æŸå†™æ³•

å½“æœ‰å¤šä¸ª trait é™åˆ¶æ—¶ï¼Œå»ºè®®ä½¿ç”¨ `where` å­å¥ï¼š

```rust
fn complex<T, U>(t: T, u: U) -> String
where
    T: std::fmt::Debug + Clone,
    U: std::fmt::Display,
{
    format!("{:?} {}", t.clone(), u)
}
```

---

## ğŸ§° æ³›å‹ä¸é»˜è®¤ç±»å‹

ä½ å¯ä»¥ä¸ºæ³›å‹å‚æ•°æŒ‡å®š**é»˜è®¤ç±»å‹**ï¼ˆä¸»è¦ç”¨äº trait å’Œ impl ä¸­ï¼‰ï¼š

```rust
trait Add<Rhs = Self> {
    type Output;
    fn add(self, rhs: Rhs) -> Self::Output;
}
```

è¿™æ˜¯æ ‡å‡†åº“ä¸­çš„ `Add` trait çš„å†™æ³•ï¼Œè¡¨ç¤º `Rhs` é»˜è®¤å°±æ˜¯ `Self`ã€‚

---

## ğŸ” æ³›å‹å’Œç”Ÿå‘½å‘¨æœŸå¯ä»¥å…±ç”¨

ä½ å¯ä»¥åŒæ—¶ä½¿ç”¨æ³›å‹å’Œç”Ÿå‘½å‘¨æœŸæ ‡æ³¨ï¼š

```rust
fn longest<'a, T: std::fmt::Display>(x: &'a str, ann: T) -> &'a str {
    println!("æ³¨é‡Šï¼š{}", ann);
    x
}
```

---

## âœ… æ³›å‹æ€»ç»“æ¸…å•

| ç”¨æ³•ä½ç½®     | ç¤ºä¾‹                           |
| -------- | ---------------------------- |
| å‡½æ•°å‚æ•°     | `fn foo<T>(x: T)`            |
| ç»“æ„ä½“å­—æ®µ    | `struct Point<T> { x: T }`   |
| æšä¸¾å˜ä½“     | `enum Option<T> { Some(T) }` |
| impl å®ç°  | `impl<T> Struct<T> {}`       |
| trait é™åˆ¶ | `T: Display + Clone`         |
| å¤šå‚æ•°      | `<T, U, V>`                  |
| where å­å¥ | `where T: Debug, U: Copy`    |

---

## ğŸ¯ å®æˆ˜ç¤ºä¾‹ï¼šè¿”å›æ•°ç»„ä¸­æœ€å¤§å€¼çš„æ³›å‹å‡½æ•°

```rust
fn find_max<T: PartialOrd + Copy>(list: &[T]) -> T {
    let mut max = list[0];
    for &item in list.iter() {
        if item > max {
            max = item;
        }
    }
    max
}

fn main() {
    let nums = vec![3, 6, 9, 2];
    println!("æœ€å¤§å€¼æ˜¯: {}", find_max(&nums)); // 9
}
```

> æ³¨æ„ï¼šä½¿ç”¨äº† `Copy` traitï¼Œå› ä¸ºæˆ‘ä»¬è¦å¤åˆ¶å€¼ã€‚å¦åˆ™å°±éœ€è¦ä½¿ç”¨å¼•ç”¨ã€‚

---

## ğŸ§  æç¤ºï¼šæ³›å‹ â‰  åŠ¨æ€ç±»å‹

Rust çš„æ³›å‹æ˜¯**é™æ€ç±»å‹çš„**ï¼Œåœ¨**ç¼–è¯‘æœŸåšç±»å‹æ›¿æ¢å¹¶ç”Ÿæˆå…·ä½“å®ç°ä»£ç **ï¼ˆå³ monomorphizationï¼‰ã€‚

æ‰€ä»¥æ³›å‹æ—¢ **é«˜æ€§èƒ½** åˆ **å®‰å…¨**ã€‚
