## 什么是结构体

结构体是 **Rust 中用来将多个相关数据组合在一起的自定义数据类型**。
它可以把不同类型的字段组合成一个整体，类似于其他语言的 `class`（但不包含方法，方法要用 `impl` 实现）。

### 定义结构体

```rust
struct Person {
    name: String,
    age: u32,
}
```

* `Person` 是结构体名（首字母大写是惯例）。
* `{}` 内是字段，包含字段名和类型。
* 每个字段必须有类型。
* 与变量不同，结构体是类型的定义。


## 创建结构体实例

```rust
fn main() {
    let person1 = Person {
        name: String::from("Alice"),
        age: 30,
    };

    println!("{} is {} years old", person1.name, person1.age);
}
```

* 用 `{}` 初始化结构体。
* 字段名必须写全。
* `String::from("Alice")` 用于创建 `String` 类型。

## 可变结构体

```rust
let mut person2 = Person {
    name: String::from("Bob"),
    age: 25,
};

person2.age += 1; // 可以修改字段
```

* 默认结构体实例是不可变的。
* 用 `mut` 可以修改字段。


## 结构体字段简写语法

如果变量名和字段名一致，可以简写：

```rust
let name = String::from("Charlie");
let age = 40;

let person3 = Person { name, age }; // 等同于 Person { name: name, age: age }
```


## 使用结构体更新语法（..）

可以基于已有实例创建新实例：

```rust
let person4 = Person {
    name: String::from("David"),
    ..person3
};
```

* 会复用 `person3` 中未指定的字段（这里复用 `age`）。
* 注意，涉及 `String` 这样的非 `Copy` 类型，原来的变量可能会被 **move**。


## 元组结构体（Tuple Struct）

结构体可以没有字段名，用元组方式：

```rust
struct Color(u8, u8, u8);

let black = Color(0, 0, 0);
```

* 用于简单封装，不关心字段名。
* 访问字段用 `.0`, `.1`, `.2`。

```rust
println!("Red: {}", black.0);
```


## 单元结构体（Unit Struct）

没有字段的结构体，类似 `()`：

```rust
struct Marker;

let m = Marker;
```

* 用于类型标记、实现 trait 等场景。


## 给结构体实现方法（impl 块）

```rust
impl Person {
    // 关联函数（类似静态函数）
    fn new(name: &str, age: u32) -> Person {
        Person {
            name: String::from(name),
            age,
        }
    }

    // 方法
    fn greet(&self) {
        println!("Hello, my name is {}", self.name);
    }

    fn have_birthday(&mut self) {
        self.age += 1;
    }
}

fn main() {
    let mut p = Person::new("Eve", 28);
    p.greet();
    p.have_birthday();
    println!("{} is now {} years old", p.name, p.age);
}
```

* `&self` 表示不可变借用结构体。
* `&mut self` 表示可变借用。
* 关联函数不需要 `self`（类似构造函数）。


## 结构体与 Debug 打印

```rust
#[derive(Debug)]
struct Point {
    x: i32,
    y: i32,
}

let p = Point { x: 10, y: 20 };
println!("{:?}", p); // 需要 #[derive(Debug)]
```

* 自定义类型要打印，必须 `#[derive(Debug)]`。
* `{:?}` 表示普通 debug 输出，`{:#?}` 表示漂亮输出。

## 总结

| 类型      | 特点                  | 示例                                        |
| ------- | ------------------- | ----------------------------------------- |
| 常规结构体   | 字段有名字               | `struct Person { name, age }`             |
| 元组结构体   | 字段无名字，按顺序访问         | `struct Color(u8,u8,u8)`                  |
| 单元结构体   | 无字段，用于类型标记或实现 trait | `struct Marker;`                          |
| impl 方法 | 为结构体添加方法或关联函数       | `impl Person { fn greet(&self) { ... } }` |

