好的，我们来做一个**全面、详细、通俗易懂的 Rust 流程控制语法解析**，包含所有常用的控制结构和细节，并附示例。Rust 的流程控制主要包括：条件语句、循环语句、跳转语句和模式匹配控制。

---

## 1. 条件语句（`if` / `else if` / `else`）

Rust 的条件语句与其他语言类似，但有几点特点：

* 条件必须是 **布尔类型** (`bool`)，不能像 C 那样使用整数。
* `if` 表达式可以有返回值，返回值类型必须一致。

**示例：**

```rust
fn main() {
    let x = 5;

    // 基本 if-else
    if x > 10 {
        println!("x 大于 10");
    } else if x == 5 {
        println!("x 等于 5");
    } else {
        println!("x 小于 10 且不等于 5");
    }

    // if 表达式可以有返回值
    let y = if x > 0 { 1 } else { -1 };
    println!("y = {}", y);
}
```

**重点：**

* Rust 的 `if` 可以直接作为表达式返回值。
* 所有分支的类型必须相同，否则编译报错。

---

## 2. 循环语句

Rust 提供三种循环方式：`loop`、`while`、`for`。

### 2.1 无限循环 `loop`

* 基本无限循环，可用 `break` 跳出。
* 可返回值，`break` 后可以指定返回值。

```rust
fn main() {
    let mut counter = 0;

    let result = loop {
        counter += 1;
        if counter == 5 {
            break counter * 2; // loop 表达式返回值
        }
    };

    println!("result = {}", result); // 输出 10
}
```

### 2.2 条件循环 `while`

* 当条件为真时执行循环。
* 常用于不知道循环次数，但有条件的情况。

```rust
fn main() {
    let mut number = 3;

    while number != 0 {
        println!("number = {}", number);
        number -= 1;
    }
}
```

### 2.3 遍历循环 `for`

* Rust 推荐使用 `for` 遍历集合。
* 避免使用 C 风格 `for (i=0; i<n; i++)`。

```rust
fn main() {
    let arr = [10, 20, 30];

    // 遍历数组
    for val in arr {
        println!("val = {}", val);
    }

    // 使用范围 (range)
    for i in 0..5 {  // 左闭右开 [0,5)
        println!("i = {}", i);
    }

    for i in 0..=5 { // 左闭右闭 [0,5]
        println!("i = {}", i);
    }
}
```

**重点：**

* `..` 左闭右开，`..=` 左闭右闭。
* `for` 循环自动获取迭代器，不会越界。

---

## 3. 跳转语句

### 3.1 `break`

* 立即退出最近的循环。
* 可以带值，常与 `loop` 配合返回值。

### 3.2 `continue`

* 跳过本次循环，进入下一次迭代。

```rust
fn main() {
    for i in 0..5 {
        if i % 2 == 0 {
            continue; // 跳过偶数
        }
        println!("奇数 i = {}", i);
    }
}
```

### 3.3 标签跳转

* Rust 支持多层循环跳出，用标签 (`'label`) 标记。

```rust
fn main() {
    'outer: for i in 0..3 {
        for j in 0..3 {
            if i + j == 3 {
                break 'outer; // 跳出外层循环
            }
            println!("i = {}, j = {}", i, j);
        }
    }
}
```

---

## 4. 模式匹配控制（`match`）

* Rust 独特的控制流工具。
* 可以匹配值、模式，支持解构和守卫。
* `match` 是表达式，可返回值，必须覆盖所有可能性（穷尽性）。

```rust
fn main() {
    let number = 2;

    let result = match number {
        1 => "one",
        2 | 3 => "two or three", // 可以匹配多个值
        4..=6 => "four to six",  // 区间匹配
        _ => "other",            // 通配符
    };

    println!("result = {}", result);

    // match 支持守卫
    let x = 5;
    match x {
        n if n % 2 == 0 => println!("偶数"),
        n if n % 2 != 0 => println!("奇数"),
        _ => println!("未知"),
    }
}
```

**重点：**

* `match` 必须覆盖所有可能性，否则编译报错。
* 可以匹配结构体、枚举、引用、解构元组等，非常灵活。

---

## 5. `if let` 和 `while let`

* 简化 `match`，匹配特定模式时执行。

```rust
fn main() {
    let some_option = Some(3);

    if let Some(x) = some_option {
        println!("匹配到 Some(x) = {}", x);
    }

    // while let 循环
    let mut stack = vec![1, 2, 3];
    while let Some(top) = stack.pop() {
        println!("弹出 {}", top);
    }
}
```

---

## 6. 总结表格

| 控制语法                   | 用途     | 特点                    |
| ---------------------- | ------ | --------------------- |
| `if / else if / else`  | 条件判断   | 表达式可返回值，条件必须是 `bool`  |
| `loop`                 | 无限循环   | 可返回值，需用 `break` 退出    |
| `while`                | 条件循环   | 循环次数不固定               |
| `for`                  | 遍历循环   | 推荐使用，避免索引越界           |
| `break`                | 退出循环   | 可带返回值                 |
| `continue`             | 跳过本次循环 | 进入下一次迭代               |
| 标签 `'label`            | 多层循环控制 | `break 'label` 跳出指定循环 |
| `match`                | 模式匹配   | 表达式，可返回值，必须穷尽匹配       |
| `if let` / `while let` | 简化匹配   | 针对特定模式                |

---

如果你愿意，我可以帮你画一张**Rust 流程控制图解**，把 `if`、循环、跳转、`match` 的逻辑一目了然地可视化，这样理解会更直观。

你希望我画吗？
